{% extends 'base/main.html' %}
{% block content %}
<!--<style type="text/css">
  #spark-line path {
    stroke: steelblue;
    stroke-width: 2;
    fill: none;
    }

#spark-line .line, circle.area {
  fill: none;
  stroke: steelblue;
  stroke-width: 1.5px;
}

#spark-line circle.area {
  fill: #fff;
}

#spark-line .point {
    fill: #C80000;
    stroke: #FFFFFF;
    stroke-width: 0px;
}
.request-point {
  fill: green;
}

.main {
  margin-top:30px;
}

#geometry {
  fill: rgba(256,256,256, .5);
  stroke: rgba(100, 100, 100, .8);
  stroke-width:3px;
  stroke-linecap: round;
}

.sidebar h1 {
  text-align:center;
}

.sidebar .box {
  text-align:center;
  border-top:1px solid #ccc;
  padding-top:10px;
}

.sidebar .label {
  font-size:14pt;
  font-weight:normal;
  font-style:italic;
}

#avg-response, #open-requests {
  font-size:32pt;
  line-height:1;
  font-weight:bold;
}
</style> -->
<div class="row main detail-page">
  <div class="span12 column">
    <div id="map"></div>
    <div id="requests">
      <table class="zebra-striped">
        <thead>
          <tr>
            <th>Request ID</th>
            <th>Type</th>
            <th>Status</th>
            <th>Date</th>
          </tr>
      </thead>
      <tbody>
      </tbody>
      </table>
    </div>
  </div>
  <div class="span4 column sidebar">
    <h1>{{ neighborhood.properties.name }}</h1>
    <div class="box" id="spark-line">
    </div>
    <div id="open-requests" class="box">
      <h3>Open Requests</h3>
      <span id="open-request-value"></span>
    </div>
    <div id="avg-response" class="box">
      <h3>Average Response Time</h3>
      <span id="average-response-value"></span>
    </div>

    <div id="top-requests" class="box">
      <h3>Top Request Types</h3>
      <table id="top-requests-table" class="zebra-striped">
        <tbody>
        </tbody>
      </table>
    </div>

  </div>
</div>
{% endblock %}

{% block custom_scripts %}
<script type="text/javascript">
  var po = org.polymaps;

  $(document).ready(function() {
      o3d.API.query = {
        coordinates_bounds: '{{ neighborhood.geometry.coordinates.0 }}',
        requested_datetime_start: '{{ start_date }}',
        requested_datetime_end: '{{ end_date }}'
      };

      map = po.map()
        .container(document.getElementById("map").appendChild(po.svg("svg")))
        .extent(o3d.map.padBox({{ bbox|safe }},.001))
        .zoomRange([10, 16]);

      map.add(po.image()
        .url(po.url("http://{S}tile.cloudmade.com"
            + "/b60fbbd51f17456794d2b0e4ed4f0d0c"
            + "/998/256/{Z}/{X}/{Y}.png")
          .hosts(["a.", "b.", "c.", ""])));

      map.add(po.geoJson()
        .url("/api/polygons/?slug={{ neighborhood.properties.slug }}")
        .id("geometry"));

      o3d.API.buildPage(map);

      var sparkData = {{ sparkline_data|safe }};
      var w = 180, h = 40;
      o3d.viz.sparkline(sparkData, '#spark-line', w, h);
  });
</script>
{% endblock %}
